id: deviceTimeTableTransformer
type: function
subtype: Function
template:
  ordered:
    - funcBody: |


        const { data } = {{ getCognitoDevices }};

        if (!data) {
          return [];
        }

        let devices = data.result.Devices ?? [];

        if (!devices.length) {
          return [];
        }

        let deviceDates = _.map(devices, (i) => {
          let shortDeviceKey = i.DeviceKey.slice(0, 15);
          let ipAddress = _.find(i.DeviceAttributes, ["Name", "last_ip_used"])["Value"];
          return [
            [
              {
                id: shortDeviceKey,
                ip_address: ipAddress,
                action: "created",
                date: i.DeviceCreateDate,
              },
            ],
            [
              {
                id: shortDeviceKey,
                ip_address: ipAddress,
                action: "last auth",
                date: i.DeviceLastAuthenticatedDate,
              },
            ],
            [
              {
                id: shortDeviceKey,
                ip_address: ipAddress,
                action: "last mod",
                date: i.DeviceLastModifiedDate,
              },
            ],
          ];
        });

        console.trace('trace:deviceDates', deviceDates)

        return _.flattenDeep(deviceDates);
    - value: ''
createdAt: 2022-06-21T18:25:10.344Z
