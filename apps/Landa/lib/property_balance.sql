SELECT financial_identity.external_object_id as ticker, SUM(CASE WHEN t.sender_financial_connection_id = checking.id THEN t.amount_amount::FLOAT * -1 ELSE t.amount_amount::FLOAT END) AS balance FROM financial_identity JOIN financial_connection as checking ON checking.financial_identity_id = financial_identity.id AND checking.primary_use = 'CHECKING'::financialconnectionprimaryuse AND checking.inactive = FALSE JOIN "transaction" t ON t.sender_financial_connection_id = checking.id OR t.receiver_financial_connection_id = checking.id WHERE  ((t.receiver_financial_connection_id = checking.id and t.transaction_status = 'COMPLETE'::transactionstatus) OR (t.sender_financial_connection_id = checking.id and t.transaction_status IN ('COMPLETE'::transactionstatus, 'PENDING'::transactionstatus, 'WAIT'::transactionstatus))) AND financial_identity.external_model_type = 'PROPERTY'::externalmodeltype AND t.date_created <= {{date}} GROUP BY financial_identity.external_object_id;